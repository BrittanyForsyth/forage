<div class="row">
  <div class="span12 hidden-desktop">
    <nav class="filter-dropdown">
      <select id="distance">
        <option value="walking" <%= 'selected="selected"' if params["distance"] == "walking" %>>Within walking distance</option>
        <option value="taxi" <%= 'selected="selected"' if params["distance"] == "taxi" %>>Within taxi distance</option>
        <option value="all" <%= 'selected="selected"' if (params["distance"] == "all" || params["distance"].blank?) %>>Show any distance</option>
        (Distances are from Shopify Ottawa)
      </select>
    </nav>
  </div>
</div>

<div class="row">
  <div class="span12 hidden-desktop">
    <nav class="filter-dropdown">
      <select id="tag">
        <option value="">Filter by taste</option>
        <% @tags.each do |tag| %>
          <option value="<%= tag.name %>" <%= 'selected="selected"' if params["tag"] == tag.name %>><%= tag.name.capitalize %></option>  
        <% end %>
      </select>
    </nav>
  </div>
</div>

<script type="text/javascript">
  function updateQueryString(key, value, url) {
      if (!url) url = window.location.href;
      var re = new RegExp("([?|&])" + key + "=.*?(&|#|$)(.*)", "gi");

      if (re.test(url)) {
          if (typeof value !== 'undefined' && value !== null)
              return url.replace(re, '$1' + key + "=" + value + '$2$3');
          else {
              var hash = url.split('#');
              url = hash[0].replace(re, '$1$3').replace(/(&|\?)$/, '');
              if (typeof hash[1] !== 'undefined' && hash[1] !== null) 
                  url += '#' + hash[1];
              return url;
          }
      }
      else {
          if (typeof value !== 'undefined' && value !== null) {
              var separator = url.indexOf('?') !== -1 ? '&' : '?',
                  hash = url.split('#');
              url = hash[0] + separator + key + '=' + value;
              if (typeof hash[1] !== 'undefined' && hash[1] !== null) 
                  url += '#' + hash[1];
              return url;
          }
          else
              return url;
      }
  }

  $("select#distance")
    .change(function() {
      $("select#distance option:selected").each(function() {
        var distanceMode = $(this).val();
        window.location.href = updateQueryString('distance', distanceMode, window.location.toString());
      });
    });

  $("select#tag")
    .change(function() {
      console.log("test");
      $("select#tag option:selected").each(function() {
        var tagMode = $(this).val();
        console.log(tagMode);
        window.location.href = updateQueryString('tag', tagMode, window.location.toString());
      });
    });
</script>